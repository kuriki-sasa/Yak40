#+BIND: org-export-filter-line-break-functions (tmp-f-line-break)
#+BEGIN_SRC emacs-lisp :exports results :results none
  (defun tmp-f-line-break (s backend info)
    (replace-in-string "\\\\" "  " s))
#+END_SRC
#+OPTIONS: num:nil

* はじめに
Yak40をお買い上げいただきありがとうございます。\\
決して難しい構造ではありませんが、このドキュメントを良く読んで組み立ててください。\\
Yak40によって、あなたのキーボードライフが少しでも楽しいものになればこれに勝る喜びはありません。

* 1. 準備
** 1.1. パーツ・工具の確認
*** 1.1.1 キットに含まれるパーツ・工具
キットには以下のパーツ・工具が含まれています。\\
不足がある場合は[[6. 連絡先]]までご連絡ください。
| 名称                      |      数量 | 画像                            | 説明                                                                                                      |
|---------------------------+-----------+---------------------------------+-----------------------------------------------------------------------------------------------------------|
| ケース                    |         1 | [[file:./images/top_case.png]]      | CNC切削アルミケース。                                                                                     |
| ボトムプレート            |         1 | [[file:./images/bottom_plate.png]]  | ケースの底板。                                                                                            |
| PCB                       |         1 | [[file:./images/pcb.png]]           | キーボードの本体となる基板。パーツはすべて実装済みです。                                                  |
| ドーターボード            |         1 | [[file:./images/udb_s1.png]]        | USBコネクター部分の基板。                                                                                   |
| ドーターボードケーブル    |         1 | [[file:./images/udb_cable.png]]     | PCBとドータボードを接続するためのケーブル。                                                               |
| スイッチプレート          |         1 | [[file:./images/switch_plate.png]]  | キースイッチを固定するためのプレート。                                                                    |
| ミドルフォーム            |         1 | [[file:./images/middle_foam.png]]   | スイッチプレートとPCBの間に挟む4mm厚のPORONフォーム。袋から取り出しづらいため、慎重に取り出してください。 |
| バーガーマウント用Oリング | 20(予備4) | [[file:./images/o_ring.png]]        | バーガーマウント用のシリコンOリング。                                                                     |
| M2x3.5 スペーサー         |  9(予備2) | [[file:./images/standoff.png]]      | スイッチプレートとPCBを固定するための4mm径のスペーサ。                                                    |
| M2x3 低頭ねじ             | 16(予備2) | [[file:./images/low_head_m2l3.png]] | スイッチプレートにPCBを取り付けるためのねじ。                                                             |
| M2x5 トラスねじ           | 10(予備2) | [[file:./images/truss_m2l5.png]]    | ケースにスイッチプレートを取り付けるためのねじ。                                                          |
| M3x6 低頭ねじ             |  2(予備1) | [[file:./images/low_head_m3l6.png]] | ドーターボードをケースに取り付けるためのねじ。                                                            |
| M3x4 なべねじ             |  8(予備1) | [[file:./images/pan_m3l4.png]]      | ケースにボトムプレートを取り付けるためのねじ。                                                            |
| ゴム足                    |  8(予備4) | [[file:./images/rubber_feet.png]]   | ボトムプレートに貼り付ける滑り止め。                                                                      |
| +ドライバー               |         1 | [[file:./images/screwdriver.png]]   | ねじを締め付けるために使用します。                                                                        |

*** 1.1.2. ご自身でご用意いただくパーツ・工具
キット以外に以下のパーツが必要になります。\\
ご自身でお気に入りのものをご用意ください。
| 名称                                  | 数量     | 説明                                                                                                                                                                     |
|---------------------------------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| MX(互換)キースイッチ                  | 41から46 | 選択したレイアウトに応じて必要な個数をご用意ください。                                                                                                                   |
| PCBマウント MX(互換)スタビライザー 2U | 0から3   | 選択したレイアウトに応じてお好みでご用意ください。                                                                                                                       |
| EC12(互換)ロータリーエンコーダー      | 0から2   | 選択したレイアウトに応じて必要な個数をご用意ください。ロータリーエンコーダーを取り付ける場合ははんだ付けが必要になります。                                               |
| MX(互換)キーキャップ                  | 1セット  | お好きなものをご用意ください。ただし、選択したレイアウトに応じてキースイッチの南向き、北向きが混在するため、キーキャップによってキースイッチと干渉する可能性があります。 |
| USB Type-Cケーブル                    | 1        | お好きなものをご用意ください。ただし、コネクター部分の形状によっては奥まで挿し込めない可能性があります。                                                                   |
| はんだごて                            | 一式     | ロータリーエンコーダーを取り付けたい場合はご用意ください。一般的な電子工作用のはんだごてで十分です。                                                                     |
| はんだ                                | 適量     | ロータリーエンコーダーを取り付けたい場合はご用意ください。                                                                                                               |

** 1.2. PCBの動作確認
*** 1.2.1. Vial環境の準備
キーマップの変更にはVial( https://get.vial.today )を使用します。\\
以下のいずれかの環境をご用意ください。
- Web版（最新のChrome、Chromium、Edge推奨）
- デスクトップアプリ版

*** 1.2.2. ファームウェア書き込み
1. 以下のURLからYak40のファームウェアをダウンロードする
   - https://github.com/kuriki-sasa/vial-qmk/releases
     [[file:./images/download_firmware.png]]
2. PCBとドーターボードをドーターボードケーブルで接続する
3. USB Type-CケーブルでPCとドーターボードを接続する
   - PCにUSBストレージとして認識されます。
4. 認識したUSBストレージにダウンロードしたファームウェアをコピーする
   - コピーが完了すると自動でUSBストレージが取り出され、キーボードとして認識されます。

*** 1.2.3. Vialを起動
Web版、またはデスクトップアプリ版Vialを起動し、キーボードが認識されていることを確認してください。\\
認識しない場合はは[[5. トラブルシューティング]]をご確認ください。\\
確認が完了したらPCから取り外し、PCB、ドーターボード、ドーターボードケーブルに分解します。

* 2. 組み立て
** 2.1. レイアウトの選択
組み立て後にスタビライザー、またはロータリーエンコーダーを取り付けることはできないため、この時点で[[https://www.keyboard-layout-editor.com/#/gists/28697eab129d40e1805bf8ff4fb0f721][対応レイアウト]]から使いたいレイアウトを選択します。\\
スタビライザー、またはロータリーエンコーダーを取り付けない場合は組み立て後からもレイアウトを変更できるため、この項目はスキップしてください。
*** 2.1.1. スタビライザーの取り付け
使いたいレイアウトに応じて以下の位置にスタビライザーを取り付けます。
[[file:./images/install_stabilizers.jpg]]
*** 2.1.2. ロータリーエンコーダーの取り付け
使いたいレイアウトに応じて以下の位置にロータリーエンコーダーをはんだ付けします。
[[file:./images/install_rotary_encoders.jpg]]
** 2.2. スイッチプレート取り付け
1. スイッチプレートの表裏に注意し、 ~M2x3 低頭ねじ~ でスペーサーを取り付ける
   [[file:./images/install_standoffs.jpg]]
2. ケースの赤丸の位置にOリングを乗せる
   [[file:./images/puton_o_rings.jpg]]
3. ケースにスイッチプレートを乗せる
   - Oリングがずれやすいため慎重に乗せてください。
4. ~M2x5 トラスねじ~ にOリングを通し、ケースにスイッチプレートを取り付ける
   [[file:./images/install_switch_plate.jpg]]
   [[file:./images/install_switch_plate_drawing.png]]
   - ゆるすぎると使用中にスイッチプレートが外れ、逆に強く締めすぎると打鍵感が固くなります。\\
     適度な力で締め付けてください。
** 2.3. PCB取り付け
1. スイッチプレートにフォームを置く
   [[file:./images/install_mid_foam.jpg]]
   - 袋から取り出しづらいため、無理に引っ張らず、慎重に取り出してください。
2. スイッチプレートに ~M2x3 低頭ねじ~ でPCBを取り付ける
   [[file:./images/install_pcb.jpg]]
   - スペーサーの高さよりもフォームのほうが少し厚くなっています。\\
     指でPCBをスイッチプレート側に押しながらねじを締めてください。
** 2.4. ドーターボード取り付け
1. ケースに ~M3x6 低頭ねじ~ でドーターボードを取り付ける
   [[file:./images/install_daughterboard.jpg]]
2. PCBとドーターボードをドーターボードケーブルで接続する
** 2.5. 動作確認
1. ケースを裏返し、キースイッチを取り付ける
   [[file:./images/install_switches.jpg]]
2. USB Type-CケーブルでPCとYak40キーボードを接続する
3. Web版、またはデスクトップアプリ版Vialを起動する
4. ~Layout~ タブを表示し、レイアウトを選択する
   [[file:./images/layout_settings.png]]
   - ドロップダウンメニューからご自身のYak40のレイアウトを選択してください。
5. ~Matrix tester~ タブを表示し、 ~Unlock~ ボタンをクリックする
   [[file:./images/unlock1.png]]
6. 表示された二箇所のキーを長押しする
   [[file:./images/unlock2.png]]
   - キーを押しているのに進捗バーが進まない場合、キーが反応していない可能性があります。\\
     [[5. トラブルシューティング]]をご確認ください。
7. 全キーが反応することを確認する
   [[file:./images/test_matrix.png]]
   - 反応しないキーがある場合は[[5. トラブルシューティング]]をご確認ください。
** 2.6. キーキャップ取り付け
用意したお気に入りのキーキャップを取り付けてください。\\
もう少しで完成です。
* 3. キーマップの設定
~Keymap~ タブを表示し、お好みのキーマップを設定してください。\\
画面上部から変更したいキーをクリックし、その後、設定したいキーを画面下部から選択します。
[[file:./images/change_keymap.png]]
* 4. メンテナンス
** 4.1. ファームウェア更新
1. ボトムプレートを取り外す
2. USB Type-CケーブルでPCとYak40キーボードを接続する
3. PCBの ~BOOT~ スイッチを押しながら ~RESET~ スイッチを押す
   - PCにUSBストレージとして認識されます。
4. 認識したUSBストレージに新しいファームウェアをコピーする
   - コピーが完了すると自動でUSBストレージが取り出され、キーボードとして認識されます。
5. ボトムプレートを取り付ける
* 5. トラブルシューティング
** 5.1. キーボードがPCに認識されない
以下手順を順番に試してください。
1. ドーターボードとPCBの接続を確認する
   - ドーターボード・PCB両方のソケットの奥までコネクターが挿さっていることを確認してください。
2. USB Type-Cケーブルが奥まで挿さっているか確認する
   - コネクター部分の形状によってはケースと干渉する可能性があります。\\
     他のUSB Type-Cケーブルでの接続もお試しください。
3. [[6. 連絡先]]に連絡する
   - お手数をおかけしますが、連絡先のいずれかから私に連絡をしてください。\\
     その際詳しい症状・写真も添付していただけますとありがたいです。
** 5.2. キースイッチが反応しない
以下手順を順番に試してください。
1. 反応しないキーのスイッチを外す
2. キースイッチの足が曲がっていないことを確認する
   - 足が曲がっていた場合は新しいキースイッチに交換するか、足を真っ直ぐに修正してから再度取り付けてください。
3. キースイッチが正しく挿さっていることを確認する
   - キースイッチがスイッチプレートから浮いている場合は、浮かないように奥まで挿してください。
4. [[6. 連絡先]]に連絡する
   - お手数をおかけしますが、連絡先のいずれかから私に連絡をしてください。\\
     その際詳しい症状・写真も添付していただけますとありがたいです。
** 5.3. ロータリーエンコーダーが反応しない
以下手順を順番に試してください。
1. 正しくはんだ付けできていることを確認する
   - キーソケットとの共存のため、はんだ付け部分(パッド)が小さくなっています。\\
     再度はんだごてでパッドを熱し、はんだ付けできていることを確認してください。
2. [[6. 連絡先]]に連絡する
   - お手数をおかけしますが、連絡先のいずれかから私に連絡をしてください。\\
     その際詳しい症状・写真も添付していただけますとありがたいです。
* 6. 連絡先
- X(Twitter): [[https://x.com/kuriki_sasa][@kuriki_sasa]]
- Bluesky: [[https://bsky.app/profile/kurikisasa.bsky.social][@kurikisasa.bsky.social]]
- Discord: kurikisasa
- Discord server: https://discord.gg/pC4t9NJStE
* さいごに
無事、完成できましたでしょうか？\\
Yak40の設計データは全て[[https://github.com/kuriki-sasa/Yak40][GitHub]]で公開しています。\\
自分で製造するもよし、参考にしてオリジナルを作るもよし、ライセンス範囲内でお好きにご活用ください。\\
良きキーボードライフを！
